---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: GitRepository
metadata:
  name: bigbang
  namespace: flux-system
spec:
  interval: 10m0s
  url: https://repo1.dso.mil/big-bang/bigbang.git
  ref:
    tag: 1.56.0
  timeout: 60s
---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: GitRepository
metadata:
  name: bigbang-values
  namespace: flux-system
spec:
  interval: 1m0s
  ref:
    branch: flux
    include:
    - repository:
        name: bigbang
      fromPath: chart
      toPath: clusters/minikube/bigbang-values/chart
      # toPath:  defaults to repository.name https://fluxcd.io/flux/components/source/gitrepositories/#include
    - repository:
        name: bigbang
      fromPath: base
      toPath: clusters/minikube/bigbang-values/base
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
kind: Kustomization
metadata:
  name: bigbang-values
spec:
  interval: 1m
  sourceRef:
    kind: GitRepository
    name: bigbang-values
  path: ./clusters/minikube/bigbang-values/kustomization.yaml
  prune: true
  valuesFrom:
    - kind: Secret
      name: terraform
      optional: true
    - kind: ConfigMap
      name: environment
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
kind: Kustomization
metadata:
  name: bigbang
  namespace: flux-system
spec:
  interval: 5m
  sourceRef:
    kind: GitRepository
    name: bigbang
  path: ./base/
  prune: true
  valuesFrom:
    - kind: Secret
      name: terraform
      optional: true
    - kind: ConfigMap
      name: environment
